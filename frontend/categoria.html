<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="Portal de Not√≠cias">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta property="og:image" content="assets/img/og-image.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="">
    <meta property="twitter:title" content="">
    <meta property="twitter:description" content="">
    <meta property="twitter:image" content="assets/img/og-image.jpg">
    
    <title>Portal de Not√≠cias</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/img/favicon.ico">
    <link rel="apple-touch-icon" href="/assets/img/apple-touch-icon.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/style.css">
    
    <!-- Schema.org structured data -->
    <script type="application/ld+json" id="category-schema">
    {
        "@context": "https://schema.org",
        "@type": "CollectionPage",
        "name": "",
        "description": "",
        "url": "",
        "mainEntity": {
            "@type": "ItemList",
            "numberOfItems": 0,
            "itemListElement": []
        }
    }
    </script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <!-- Header Top -->
        <div class="header-top">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center">
                            <span class="me-3">
                                <i class="fas fa-calendar-alt me-1"></i>
                                <span id="current-date"></span>
                            </span>
                            <span>
                                <i class="fas fa-thermometer-half me-1"></i>
                                <span id="weather-info">Carregando...</span>
                            </span>
                        </div>
                    </div>
                    <div class="col-md-6 text-right">
                        <div class="d-flex align-items-center justify-content-end">
                            <div class="social-links me-3">
                                <a href="#" class="me-2" aria-label="Facebook">
                                    <i class="fab fa-facebook-f"></i>
                                </a>
                                <a href="#" class="me-2" aria-label="Twitter">
                                    <i class="fab fa-twitter"></i>
                                </a>
                                <a href="#" class="me-2" aria-label="Instagram">
                                    <i class="fab fa-instagram"></i>
                                </a>
                                <a href="#" aria-label="YouTube">
                                    <i class="fab fa-youtube"></i>
                                </a>
                            </div>
                            <div class="user-actions">
                                <div class="logged-out-only">
                                    <a href="login.html" class="btn btn-sm btn-outline-primary me-2">Entrar</a>
                                    <a href="cadastro.html" class="btn btn-sm btn-primary">Cadastrar</a>
                                </div>
                                <div class="logged-in-only" style="display: none;">
                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                            <i class="fas fa-user me-1"></i>
                                            <span data-user-info="nome">Usu√°rio</span>
                                        </button>
                                        <div class="dropdown-menu">
                                            <a class="dropdown-item" href="perfil.html">
                                <i class="fas fa-user me-2"></i>Meu Perfil
                            </a>
                            <a class="dropdown-item" href="favoritos.html">
                                <i class="fas fa-heart me-2"></i>Favoritos
                            </a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#" onclick="logout()">
                                                <i class="fas fa-sign-out-alt me-2"></i>Sair
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button class="theme-toggle ms-3" aria-label="Alternar tema">
                                üåô
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Header Main -->
        <div class="header-main">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-3">
                        <a href="/" class="logo">
                            <i class="fas fa-newspaper me-2"></i>
                            Portal Not√≠cias
                        </a>
                    </div>
                    <div class="col-md-6">
                        <form class="search-form mx-auto">
                            <div class="position-relative">
                                <input type="text" class="form-control search-input" placeholder="Buscar not√≠cias..." autocomplete="off">
                                <button type="submit" class="search-btn" aria-label="Buscar">
                                    <i class="fas fa-search"></i>
                                </button>
                                <div class="search-suggestions" style="display: none;"></div>
                            </div>
                        </form>
                    </div>
                    <div class="col-md-3 text-right">
                        <div class="d-flex align-items-center justify-content-end">
                            <a href="newsletter.html" class="btn btn-outline-secondary btn-sm me-2">
                                <i class="fas fa-envelope me-1"></i>
                                Newsletter
                            </a>
                            <a href="/rss" class="btn btn-outline-secondary btn-sm" target="_blank">
                                <i class="fas fa-rss me-1"></i>
                                RSS
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Navigation -->
        <nav class="navbar">
            <div class="container">
                <div class="d-flex align-items-center justify-content-between w-100">
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="/" class="nav-link">
                                <i class="fas fa-home me-1"></i>
                                In√≠cio
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/categoria/politica" class="nav-link">Pol√≠tica</a>
                        </li>
                        <li class="nav-item">
                            <a href="/categoria/economia" class="nav-link">Economia</a>
                        </li>
                        <li class="nav-item">
                            <a href="/categoria/esportes" class="nav-link">Esportes</a>
                        </li>
                        <li class="nav-item">
                            <a href="/categoria/tecnologia" class="nav-link">Tecnologia</a>
                        </li>
                        <li class="nav-item">
                            <a href="/categoria/saude" class="nav-link">Sa√∫de</a>
                        </li>
                        <li class="nav-item">
                            <a href="/categoria/cultura" class="nav-link">Cultura</a>
                        </li>
                        <li class="nav-item">
                            <a href="/categoria/internacional" class="nav-link">Internacional</a>
                        </li>
                    </ul>
                    
                    <button class="mobile-menu-toggle d-lg-none" aria-label="Menu" aria-expanded="false">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </nav>
    </header>
    
    <!-- Breadcrumb -->
    <nav class="breadcrumb-nav bg-light py-2">
        <div class="container">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="/">In√≠cio</a></li>
                <li class="breadcrumb-item active" id="breadcrumb-category">Categoria</li>
            </ol>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="main-content">
        <div class="container mt-4">
            <!-- Category Header -->
            <div class="category-header mb-4">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="category-title mb-2" id="category-title">
                            <i class="fas fa-folder-open me-2"></i>
                            Categoria
                        </h1>
                        <p class="category-description text-muted mb-0" id="category-description" style="display: none;"></p>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <div class="category-stats">
                            <span class="badge bg-primary me-2">
                                <i class="fas fa-newspaper me-1"></i>
                                <span id="category-count">0</span> not√≠cias
                            </span>
                            <button class="btn btn-outline-primary btn-sm" id="follow-category" style="display: none;">
                                <i class="fas fa-plus me-1"></i>
                                Seguir
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <!-- News Content -->
                <div class="col-lg-8">
                    <!-- Filters and Sorting -->
                    <div class="news-filters mb-4">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <label class="me-2 text-muted">Ordenar por:</label>
                                    <select class="form-control form-control-sm" id="sort-select" style="width: auto;">
                                        <option value="newest">Mais Recentes</option>
                                        <option value="oldest">Mais Antigas</option>
                                        <option value="popular">Mais Populares</option>
                                        <option value="views">Mais Visualizadas</option>
                                        <option value="comments">Mais Comentadas</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6 text-md-end">
                                <div class="view-toggle">
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-outline-secondary btn-sm active" data-view="grid" title="Visualiza√ß√£o em grade">
                                            <i class="fas fa-th"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm" data-view="list" title="Visualiza√ß√£o em lista">
                                            <i class="fas fa-list"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Featured News (if any) -->
                    <section class="featured-news mb-4" id="featured-news-section" style="display: none;">
                        <h3 class="section-title mb-3">
                            <i class="fas fa-star text-warning me-2"></i>
                            Destaques da Categoria
                        </h3>
                        <div class="row" id="featured-news">
                            <!-- Not√≠cias em destaque ser√£o carregadas via JavaScript -->
                        </div>
                    </section>
                    
                    <!-- News List -->
                    <section class="news-list">
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <h3 class="section-title mb-0">
                                <i class="fas fa-newspaper me-2"></i>
                                Todas as Not√≠cias
                            </h3>
                            <div class="results-info text-muted small">
                                Mostrando <span id="showing-count">0</span> de <span id="total-count">0</span> not√≠cias
                            </div>
                        </div>
                        
                        <div class="news-grid" id="news-container">
                            <!-- Not√≠cias ser√£o carregadas via JavaScript -->
                            <div class="col-12 text-center py-5">
                                <div class="loading"></div>
                                <p class="mt-3 text-muted">Carregando not√≠cias...</p>
                            </div>
                        </div>
                        
                        <!-- Load More Button -->
                        <div class="text-center mt-4">
                            <button class="btn btn-outline-primary load-more-btn" id="load-more-news" style="display: none;">
                                <i class="fas fa-plus me-1"></i>
                                Carregar mais not√≠cias
                            </button>
                        </div>
                        
                        <!-- No Results -->
                        <div class="no-results text-center py-5" id="no-results" style="display: none;">
                            <i class="fas fa-search fa-3x text-muted mb-3"></i>
                            <h4 class="text-muted">Nenhuma not√≠cia encontrada</h4>
                            <p class="text-muted">N√£o h√° not√≠cias dispon√≠veis nesta categoria no momento.</p>
                            <a href="/" class="btn btn-primary mt-3">
                                <i class="fas fa-home me-1"></i>
                                Voltar ao In√≠cio
                            </a>
                        </div>
                    </section>
                    
                    <!-- Pagination -->
                    <nav class="pagination-nav mt-4" id="pagination-nav" style="display: none;">
                        <ul class="pagination justify-content-center" id="pagination">
                            <!-- Pagina√ß√£o ser√° gerada via JavaScript -->
                        </ul>
                    </nav>
                </div>
                
                <!-- Sidebar -->
                <div class="col-lg-4">
                    <!-- Category Info -->
                    <aside class="sidebar" id="category-info-sidebar" style="display: none;">
                        <h3 class="sidebar-title">
                            <i class="fas fa-info-circle text-info me-2"></i>
                            Sobre esta Categoria
                        </h3>
                        <div class="category-info">
                            <p id="category-full-description"></p>
                            <div class="category-stats-detailed">
                                <div class="stat-item mb-2">
                                    <i class="fas fa-newspaper text-primary me-2"></i>
                                    <strong id="category-total-news">0</strong> not√≠cias publicadas
                                </div>
                                <div class="stat-item mb-2">
                                    <i class="fas fa-eye text-success me-2"></i>
                                    <strong id="category-total-views">0</strong> visualiza√ß√µes
                                </div>
                                <div class="stat-item mb-2">
                                    <i class="fas fa-calendar text-warning me-2"></i>
                                    √öltima atualiza√ß√£o: <span id="category-last-update">-</span>
                                </div>
                            </div>
                        </div>
                    </aside>
                    
                    <!-- Related Categories -->
                    <aside class="sidebar">
                        <h3 class="sidebar-title">
                            <i class="fas fa-folder text-info me-2"></i>
                            Outras Categorias
                        </h3>
                        <ul class="sidebar-list categories-list" id="related-categories">
                            <!-- Categorias relacionadas ser√£o carregadas via JavaScript -->
                            <li class="text-center py-3">
                                <div class="loading"></div>
                            </li>
                        </ul>
                    </aside>
                    
                    <!-- Popular News -->
                    <aside class="sidebar">
                        <h3 class="sidebar-title">
                            <i class="fas fa-fire text-danger me-2"></i>
                            Mais Lidas
                        </h3>
                        <div class="popular-news" id="popular-news">
                            <!-- Not√≠cias populares ser√£o carregadas via JavaScript -->
                            <div class="text-center py-3">
                                <div class="loading"></div>
                            </div>
                        </div>
                    </aside>
                    
                    <!-- Popular Tags -->
                    <aside class="sidebar">
                        <h3 class="sidebar-title">
                            <i class="fas fa-tags text-success me-2"></i>
                            Tags Populares
                        </h3>
                        <div class="tags" id="popular-tags">
                            <!-- Tags populares ser√£o carregadas via JavaScript -->
                            <div class="text-center py-3">
                                <div class="loading"></div>
                            </div>
                        </div>
                    </aside>
                    
                    <!-- Advertisement -->
                    <aside class="sidebar text-center">
                        <h4 class="sidebar-title">Publicidade</h4>
                        <div class="ad-banner">
                            <div class="bg-light p-4 border rounded">
                                <p class="text-muted mb-2">Espa√ßo Publicit√°rio</p>
                                <p class="small text-muted">300x250</p>
                            </div>
                        </div>
                    </aside>
                    
                    <!-- Newsletter Signup -->
                    <aside class="sidebar bg-primary text-white">
                        <h3 class="sidebar-title text-white">
                            <i class="fas fa-envelope me-2"></i>
                            Newsletter
                        </h3>
                        <p class="mb-3">Receba as principais not√≠cias diretamente no seu e-mail!</p>
                        <form class="newsletter-form ajax-form" action="http://localhost:8001/newsletter/subscribe" method="POST">
                            <div class="form-group mb-3">
                                <input type="email" name="email" class="form-control" placeholder="Seu e-mail" required>
                            </div>
                            <button type="submit" class="btn btn-light btn-block w-100">
                                <i class="fas fa-paper-plane me-1"></i>
                                Inscrever-se
                            </button>
                        </form>
                    </aside>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4">
                    <h5>Portal de Not√≠cias</h5>
                    <p class="mb-3">Seu portal de not√≠cias confi√°vel, trazendo as principais informa√ß√µes do Brasil e do mundo com credibilidade e agilidade.</p>
                    <div class="social-links">
                        <a href="#" class="me-3" aria-label="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="me-3" aria-label="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="me-3" aria-label="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="me-3" aria-label="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                        <a href="#" aria-label="LinkedIn">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                    </div>
                </div>
                
                <div class="col-lg-2 col-md-6 mb-4">
                    <h5>Categorias</h5>
                    <ul class="list-unstyled">
                        <li><a href="/categoria/politica">Pol√≠tica</a></li>
                        <li><a href="/categoria/economia">Economia</a></li>
                        <li><a href="/categoria/esportes">Esportes</a></li>
                        <li><a href="/categoria/tecnologia">Tecnologia</a></li>
                        <li><a href="/categoria/saude">Sa√∫de</a></li>
                        <li><a href="/categoria/cultura">Cultura</a></li>
                    </ul>
                </div>
                
                <div class="col-lg-2 col-md-6 mb-4">
                    <h5>Institucional</h5>
                    <ul class="list-unstyled">
                        <li><a href="/sobre">Sobre N√≥s</a></li>
                        <li><a href="/contato">Contato</a></li>
                        <li><a href="/equipe">Nossa Equipe</a></li>
                        <li><a href="/anuncie">Anuncie Conosco</a></li>
                        <li><a href="/trabalhe-conosco">Trabalhe Conosco</a></li>
                    </ul>
                </div>
                
                <div class="col-lg-2 col-md-6 mb-4">
                    <h5>Suporte</h5>
                    <ul class="list-unstyled">
                        <li><a href="/ajuda">Central de Ajuda</a></li>
                        <li><a href="/privacidade">Pol√≠tica de Privacidade</a></li>
                        <li><a href="/termos">Termos de Uso</a></li>
                        <li><a href="/cookies">Pol√≠tica de Cookies</a></li>
                        <li><a href="/sitemap">Mapa do Site</a></li>
                    </ul>
                </div>
                
                <div class="col-lg-2 col-md-6 mb-4">
                    <h5>Conecte-se</h5>
                    <ul class="list-unstyled">
                        <li><a href="/newsletter">Newsletter</a></li>
                        <li><a href="/rss">Feed RSS</a></li>
                        <li><a href="/app">Aplicativo Mobile</a></li>
                        <li><a href="/notificacoes">Notifica√ß√µes Push</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <p class="mb-0">&copy; 2024 Portal de Not√≠cias. Todos os direitos reservados.</p>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <p class="mb-0">
                            Desenvolvido com <i class="fas fa-heart text-danger"></i> pela equipe Portal de Not√≠cias
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Back to Top -->
    <button class="btn btn-primary back-to-top" id="backToTop" style="display: none;" aria-label="Voltar ao topo">
        <i class="fas fa-chevron-up"></i>
    </button>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Scripts -->
    <script src="/assets/js/main.js"></script>
    
    <!-- Category Specific Scripts -->
    <script>
        let currentPage = 1;
        let currentSort = 'newest';
        let currentView = 'grid';
        let categorySlug = '';
        let categoryData = null;
        let isLoading = false;
        let hasMoreNews = true;
        
        // Carrega dados da categoria
        document.addEventListener('DOMContentLoaded', function() {
            // Extrai o slug da URL
            const pathParts = window.location.pathname.split('/');
            const categoriaIndex = pathParts.indexOf('categoria');
            
            if (categoriaIndex !== -1 && pathParts[categoriaIndex + 1]) {
                categorySlug = pathParts[categoriaIndex + 1];
            } else {
                // Fallback para par√¢metros de URL
                const urlParams = new URLSearchParams(window.location.search);
                categorySlug = urlParams.get('categoria');
            }
            
            // Remove extens√£o .html se presente
            if (categorySlug && categorySlug.endsWith('.html')) {
                categorySlug = categorySlug.replace('.html', '');
            }
            
            // Se ainda n√£o temos um slug v√°lido, usa um padr√£o para teste
            if (!categorySlug || categorySlug === 'categoria') {
                categorySlug = 'politica'; // categoria padr√£o para teste
            }
            
            loadCategoryData();
            setupEventListeners();
        });
        
        // Configura event listeners
        function setupEventListeners() {
            // Ordena√ß√£o
            document.getElementById('sort-select').addEventListener('change', function() {
                currentSort = this.value;
                currentPage = 1;
                loadNews(true);
            });
            
            // Visualiza√ß√£o
            document.querySelectorAll('[data-view]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('[data-view]').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentView = this.dataset.view;
                    toggleView(currentView);
                });
            });
            
            // Carregar mais
            document.getElementById('load-more-news').addEventListener('click', function() {
                currentPage++;
                loadNews(false);
            });
            
            // Seguir categoria
            document.getElementById('follow-category').addEventListener('click', function() {
                followCategory();
            });
        }
        
        // Carrega dados da categoria
        async function loadCategoryData() {
            try {
                const response = await fetch(`http://localhost:8001/categorias/slug/${categorySlug}`);
                const result = await response.json();
                
                if (result.success) {
                    categoryData = result.data;
                    populateCategoryData(categoryData);
                    loadNews(true);
                    loadSidebarData();
                } else {
                    showError('Categoria n√£o encontrada.');
                }
            } catch (error) {
                console.error('Erro ao carregar categoria:', error);
                showError('Erro ao carregar categoria.');
            }
        }
        
        // Popula dados da categoria
        function populateCategoryData(category) {
            // Meta tags
            document.title = `${category.nome} - Portal de Not√≠cias`;
            document.querySelector('meta[name="description"]').content = category.descricao || `Not√≠cias de ${category.nome}`;
            document.querySelector('meta[name="keywords"]').content = category.nome;
            
            // Open Graph
            document.querySelector('meta[property="og:title"]').content = `${category.nome} - Portal de Not√≠cias`;
            document.querySelector('meta[property="og:description"]').content = category.descricao || `Not√≠cias de ${category.nome}`;
            document.querySelector('meta[property="og:url"]').content = window.location.href;
            
            // Twitter
            document.querySelector('meta[property="twitter:title"]').content = `${category.nome} - Portal de Not√≠cias`;
            document.querySelector('meta[property="twitter:description"]').content = category.descricao || `Not√≠cias de ${category.nome}`;
            
            // Breadcrumb
            document.getElementById('breadcrumb-category').textContent = category.nome;
            
            // Category header
            document.getElementById('category-title').innerHTML = `
                <i class="${category.icone || 'fas fa-folder-open'} me-2"></i>
                ${category.nome}
            `;
            
            if (category.descricao) {
                document.getElementById('category-description').style.display = 'block';
                document.getElementById('category-description').textContent = category.descricao;
            }
            
            // Category stats
            document.getElementById('category-count').textContent = category.total_noticias || 0;
            
            // Sidebar info
            if (category.descricao) {
                document.getElementById('category-info-sidebar').style.display = 'block';
                document.getElementById('category-full-description').textContent = category.descricao;
                document.getElementById('category-total-news').textContent = category.total_noticias || 0;
                document.getElementById('category-total-views').textContent = formatNumber(category.total_visualizacoes || 0);
                
                if (category.ultima_atualizacao) {
                    document.getElementById('category-last-update').textContent = formatDate(category.ultima_atualizacao);
                }
            }
            
            // Navigation highlight
            document.querySelectorAll('.nav-link').forEach(link => {
                if (link.href.includes(`/categoria/${categorySlug}`)) {
                    link.classList.add('active');
                }
            });
            
            // Schema.org
            const schema = {
                "@context": "https://schema.org",
                "@type": "CollectionPage",
                "name": category.nome,
                "description": category.descricao || `Not√≠cias de ${category.nome}`,
                "url": window.location.href,
                "mainEntity": {
                    "@type": "ItemList",
                    "numberOfItems": category.total_noticias || 0,
                    "itemListElement": []
                }
            };
            
            document.getElementById('category-schema').textContent = JSON.stringify(schema);
        }
        
        // Carrega not√≠cias
        async function loadNews(reset = false) {
            if (isLoading) return;
            
            isLoading = true;
            
            if (reset) {
                currentPage = 1;
                hasMoreNews = true;
            }
            
            try {
                const params = new URLSearchParams({
                    page: currentPage,
                    limit: 12,
                    sort: currentSort
                });
                
                const response = await fetch(`http://localhost:8001/noticias/categoria/${categorySlug}?${params}`);
                const result = await response.json();
                
                if (result.success) {
                    displayNews(result.data.noticias, reset);
                    updatePagination(result.data.paginacao);
                    
                    // Atualiza contadores
                    const totalItens = result.data.paginacao.total_itens;
                    const itensPorPagina = result.data.paginacao.itens_por_pagina;
                    const paginaAtual = result.data.paginacao.pagina_atual;
                    const showing = Math.min(paginaAtual * itensPorPagina, totalItens);
                    
                    document.getElementById('showing-count').textContent = showing;
                    document.getElementById('total-count').textContent = totalItens;
                    
                    hasMoreNews = paginaAtual < result.data.paginacao.total_paginas;
                    document.getElementById('load-more-news').style.display = hasMoreNews ? 'block' : 'none';
                    
                    // Carrega not√≠cias em destaque se for a primeira p√°gina
                    if (currentPage === 1) {
                        loadFeaturedNews();
                    }
                } else {
                    if (currentPage === 1) {
                        showNoResults();
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar not√≠cias:', error);
                showError('Erro ao carregar not√≠cias.');
            } finally {
                isLoading = false;
            }
        }
        
        // Exibe not√≠cias
        function displayNews(news, reset = false) {
            const container = document.getElementById('news-container');
            
            if (reset) {
                container.innerHTML = '';
            }
            
            if (news.length === 0 && reset) {
                showNoResults();
                return;
            }
            
            const newsHTML = news.map(item => createNewsHTML(item, currentView)).join('');
            
            if (reset) {
                container.innerHTML = newsHTML;
            } else {
                container.insertAdjacentHTML('beforeend', newsHTML);
            }
            
            // Aplica lazy loading
            if (window.PortalNoticias) {
                window.PortalNoticias.initLazyLoading();
            }
        }
        
        // Cria HTML da not√≠cia
        function createNewsHTML(news, view) {
            const colClass = view === 'list' ? 'col-12' : 'col-md-6 col-lg-4';
            const cardClass = view === 'list' ? 'news-card-horizontal' : 'news-card';
            
            return `
                <div class="${colClass} mb-4">
                    <div class="card ${cardClass}">
                        ${news.imagem ? `
                            <div class="news-card-image">
                                <img src="${news.imagem}" alt="${news.titulo}" class="card-img lazy" loading="lazy">
                                <div class="news-card-overlay">
                                    <a href="/noticia/${news.slug}" class="btn btn-primary btn-sm">
                                        <i class="fas fa-eye me-1"></i>
                                        Ler mais
                                    </a>
                                </div>
                            </div>
                        ` : ''}
                        <div class="card-body">
                            <div class="news-card-meta mb-2">
                                <span class="badge bg-primary me-2">${news.categoria}</span>
                                <small class="text-muted">
                                    <i class="fas fa-clock me-1"></i>
                                    ${formatDate(news.data_publicacao)}
                                </small>
                            </div>
                            <h5 class="news-card-title">
                                <a href="/noticia/${news.slug}">${news.titulo}</a>
                            </h5>
                            ${view === 'list' && news.resumo ? `
                                <p class="news-card-excerpt text-muted">${news.resumo}</p>
                            ` : ''}
                            <div class="news-card-footer d-flex align-items-center justify-content-between">
                                <div class="author-info d-flex align-items-center">
                                    <img src="${news.autor_foto || '/assets/img/default-avatar.png'}" alt="${news.autor}" class="author-avatar-sm me-2">
                                    <small class="text-muted">${news.autor}</small>
                                </div>
                                <div class="news-stats">
                                    <small class="text-muted me-2">
                                        <i class="fas fa-eye me-1"></i>
                                        ${formatNumber(news.visualizacoes)}
                                    </small>
                                    <small class="text-muted">
                                        <i class="fas fa-heart me-1"></i>
                                        ${formatNumber(news.curtidas)}
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Carrega not√≠cias em destaque
        async function loadFeaturedNews() {
            try {
                const params = new URLSearchParams({
                    action: 'featured',
                    categoria_id: categoryData ? categoryData.id : '',
                    limit: 3
                });
                const response = await fetch(`http://localhost:8001/noticias?${params}`);
                const result = await response.json();
                
                if (result.noticias && result.noticias.length > 0) {
                    document.getElementById('featured-news-section').style.display = 'block';
                    displayFeaturedNews(result.noticias);
                }
            } catch (error) {
                console.error('Erro ao carregar not√≠cias em destaque:', error);
            }
        }
        
        // Exibe not√≠cias em destaque
        function displayFeaturedNews(news) {
            const container = document.getElementById('featured-news');
            container.innerHTML = news.map(item => `
                <div class="col-md-6 mb-3">
                    <div class="card news-card featured-card">
                        <div class="news-card-image">
                            <img src="${item.imagem}" alt="${item.titulo}" class="card-img">
                            <div class="featured-badge">
                                <i class="fas fa-star"></i>
                            </div>
                        </div>
                        <div class="card-body">
                            <h6 class="news-card-title">
                                <a href="/noticia/${item.slug}">${item.titulo}</a>
                            </h6>
                            <div class="news-card-meta">
                                <small class="text-muted">${formatDate(item.data_publicacao)}</small>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // Carrega dados da sidebar
        async function loadSidebarData() {
            loadRelatedCategories();
            loadPopularNews();
            loadPopularTags();
        }
        
        // Carrega categorias relacionadas
        async function loadRelatedCategories() {
            try {
                const response = await fetch('http://localhost:8001/categorias');
                const result = await response.json();
                
                if (result.success && result.data.categorias) {
                    const categories = result.data.categorias.filter(cat => cat.slug !== categorySlug).slice(0, 8);
                    displayRelatedCategories(categories);
                }
            } catch (error) {
                console.error('Erro ao carregar categorias:', error);
            }
        }
        
        // Exibe categorias relacionadas
        function displayRelatedCategories(categories) {
            const container = document.getElementById('related-categories');
            container.innerHTML = categories.map(category => `
                <li>
                    <a href="/categoria/${category.slug}" class="d-flex align-items-center justify-content-between">
                        <span>
                            <i class="${category.icone || 'fas fa-folder'} me-2"></i>
                            ${category.nome}
                        </span>
                        <span class="badge bg-light text-dark">${category.total_noticias || 0}</span>
                    </a>
                </li>
            `).join('');
        }
        
        // Carrega not√≠cias populares
        async function loadPopularNews() {
            try {
                const response = await fetch('http://localhost:8001/noticias?action=popular&limit=5');
                const result = await response.json();
                
                if (result.success) {
                    displayPopularNews(result.data);
                }
            } catch (error) {
                console.error('Erro ao carregar not√≠cias populares:', error);
            }
        }
        
        // Exibe not√≠cias populares
        function displayPopularNews(news) {
            const container = document.getElementById('popular-news');
            container.innerHTML = news.map((item, index) => `
                <div class="popular-item d-flex mb-3">
                    <div class="popular-rank me-3">
                        <span class="badge bg-primary">${index + 1}</span>
                    </div>
                    <div class="popular-content flex-grow-1">
                        <h6 class="popular-title mb-1">
                            <a href="/noticia/${item.slug}">${item.titulo}</a>
                        </h6>
                        <div class="popular-meta">
                            <small class="text-muted">
                                <i class="fas fa-eye me-1"></i>
                                ${formatNumber(item.visualizacoes)}
                            </small>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // Carrega tags populares
        async function loadPopularTags() {
            try {
                const response = await fetch('http://localhost:8001/tags?action=popular&limit=20');
                const result = await response.json();
                
                if (result.success) {
                    displayPopularTags(result.data);
                }
            } catch (error) {
                console.error('Erro ao carregar tags populares:', error);
            }
        }
        
        // Exibe tags populares
        function displayPopularTags(tags) {
            const container = document.getElementById('popular-tags');
            container.innerHTML = tags.map(tag => `
                <a href="/tag/${tag.slug}" class="tag" style="font-size: ${Math.min(1.2, 0.8 + (tag.total_noticias / 10))}em;">
                    ${tag.nome}
                </a>
            `).join('');
        }
        
        // Alterna visualiza√ß√£o
        function toggleView(view) {
            const container = document.getElementById('news-container');
            container.className = view === 'list' ? 'news-list-view' : 'news-grid row';
            
            // Recarrega not√≠cias com nova visualiza√ß√£o
            if (container.children.length > 0) {
                loadNews(true);
            }
        }
        
        // Atualiza pagina√ß√£o
        function updatePagination(pagination) {
            if (pagination.totalPages <= 1) {
                document.getElementById('pagination-nav').style.display = 'none';
                return;
            }
            
            document.getElementById('pagination-nav').style.display = 'block';
            const container = document.getElementById('pagination');
            
            let paginationHTML = '';
            
            // Bot√£o anterior
            if (pagination.hasPrev) {
                paginationHTML += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="goToPage(${pagination.currentPage - 1})">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                    </li>
                `;
            }
            
            // P√°ginas
            for (let i = Math.max(1, pagination.currentPage - 2); i <= Math.min(pagination.totalPages, pagination.currentPage + 2); i++) {
                paginationHTML += `
                    <li class="page-item ${i === pagination.currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="goToPage(${i})">${i}</a>
                    </li>
                `;
            }
            
            // Bot√£o pr√≥ximo
            if (pagination.hasNext) {
                paginationHTML += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="goToPage(${pagination.currentPage + 1})">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </li>
                `;
            }
            
            container.innerHTML = paginationHTML;
        }
        
        // Vai para p√°gina espec√≠fica
        function goToPage(page) {
            currentPage = page;
            loadNews(true);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Segue categoria
        async function followCategory() {
            // Implementar funcionalidade de seguir categoria
            showSuccess('Categoria seguida com sucesso!');
        }
        
        // Mostra resultado vazio
        function showNoResults() {
            document.getElementById('news-container').innerHTML = '';
            document.getElementById('no-results').style.display = 'block';
        }
        
        // Utilit√°rios
        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('pt-BR', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }
        
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }
        
        function showSuccess(message) {
            // Implementar notifica√ß√£o de sucesso
            alert(message);
        }
        
        function showError(message) {
            // Implementar notifica√ß√£o de erro
            alert(message);
        }
        
        // Atualiza data atual
        document.getElementById('current-date').textContent = new Date().toLocaleDateString('pt-BR', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        
        // Bot√£o voltar ao topo
        window.addEventListener('scroll', function() {
            const backToTop = document.getElementById('backToTop');
            if (window.pageYOffset > 300) {
                backToTop.style.display = 'block';
            } else {
                backToTop.style.display = 'none';
            }
        });
        
        document.getElementById('backToTop').addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        
        // Fun√ß√£o de logout
        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                localStorage.removeItem('authToken');
                localStorage.removeItem('portal-user');
                localStorage.removeItem('userData');
                window.location.href = 'login.html';
            }
        }
        
        // Carrega informa√ß√µes do clima (simulado)
        setTimeout(() => {
            document.getElementById('weather-info').textContent = 'S√£o Paulo: 25¬∞C';
        }, 1000);
    </script>
    
    <!-- Google Analytics (substitua pelo seu ID) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID');
    </script>
</body>
</html>