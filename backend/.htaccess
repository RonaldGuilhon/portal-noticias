# Headers de segurança
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "strict-origin-when-cross-origin"

# CORS Headers
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"

# Permitir acesso aos controllers
<FilesMatch "Controller\.php$">
    Order Allow,Deny
    Allow from all
</FilesMatch>

# Bloquear acesso a outros arquivos PHP sensíveis
<FilesMatch "^(config|models|services|utils|middleware)\/.*\.php$">
    Order Deny,Allow
    Deny from all
</FilesMatch>

# Habilitar reescrita de URL
RewriteEngine On

# Roteamento para notícias
RewriteRule ^noticias/destaques/?$ controllers/NoticiaController.php?action=featured [L,QSA]
RewriteRule ^noticias/populares/?$ controllers/NoticiaController.php?action=popular [L,QSA]
RewriteRule ^noticias/recentes/?$ controllers/NoticiaController.php?action=recent [L,QSA]
RewriteRule ^noticias/([0-9]+)/?$ controllers/NoticiaController.php?action=get&id=$1 [L,QSA]
RewriteRule ^noticias/([^/]+)/?$ controllers/NoticiaController.php?action=get&slug=$1 [L,QSA]
RewriteRule ^noticias/?$ controllers/NoticiaController.php?action=list [L,QSA]

# Roteamento para categorias
RewriteRule ^categorias/([0-9]+)/?$ controllers/CategoriaController.php?action=obter&id=$1 [L,QSA]
RewriteRule ^categorias/([^/]+)/?$ controllers/CategoriaController.php?action=obter&slug=$1 [L,QSA]
RewriteRule ^categorias/?$ controllers/CategoriaController.php?action=listar [L,QSA]

# Roteamento para tags
RewriteRule ^tags/([0-9]+)/?$ controllers/TagController.php?action=obter&id=$1 [L,QSA]
RewriteRule ^tags/([^/]+)/?$ controllers/TagController.php?action=obter&slug=$1 [L,QSA]
RewriteRule ^tags/?$ controllers/TagController.php?action=listar [L,QSA]

# Roteamento para comentários
RewriteRule ^comentarios/noticia/([0-9]+)/?$ controllers/ComentarioController.php?action=listarPorNoticia&noticia_id=$1 [L,QSA]
RewriteRule ^comentarios/?$ controllers/ComentarioController.php?action=listar [L,QSA]

# Roteamento para autenticação
RewriteRule ^auth/login/?$ controllers/AuthController.php?action=login [L,QSA]
RewriteRule ^auth/register/?$ controllers/AuthController.php?action=register [L,QSA]
RewriteRule ^auth/logout/?$ controllers/AuthController.php?action=logout [L,QSA]
RewriteRule ^auth/forgot-password/?$ controllers/AuthController.php?action=forgotPassword [L,QSA]

# Roteamento para API de usuário
RewriteRule ^api/user/profile/?$ controllers/AuthController.php?action=profile [L,QSA]

# Roteamento para busca
RewriteRule ^search/?$ controllers/SearchController.php?action=buscar [L,QSA]

# Roteamento para cache
RewriteRule ^cache/stats/?$ controllers/CacheController.php?action=stats [L,QSA]
RewriteRule ^cache/clear/?$ controllers/CacheController.php?action=clear [L,QSA]
RewriteRule ^cache/?$ controllers/CacheController.php?action=stats [L,QSA]

# Configuração para servir arquivos de upload do disco D
Alias /uploads C:/portal-noticias-uploads

<Directory "C:/portal-noticias-uploads">
    Options Indexes FollowSymLinks
    AllowOverride None
    Require all granted
</Directory>

# Configurações de segurança para uploads
<Directory "C:/portal-noticias-uploads">
    <FilesMatch "\.(php|phtml|php3|php4|php5|pl|py|jsp|asp|sh|cgi)$">
        Require all denied
    </FilesMatch>
</Directory>